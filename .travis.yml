language: go

go:
  - 1.19.2

install: true

env:
  global:
    - MYAPP=watchgo
    - MYEMAIL=martinuz.dawan9@gmail.com
    - secure: ${GITHUB_TOKEN}

before_install:
  - sudo apt-get -qq update
  - mkdir -p ${GOPATH}/bin

install:
  - ls
  - cd $GOPATH/src/github.com/hinha/$MYAPP
  - ls

script: echo "pass"

# build the app,build the package
before_deploy:
  - mkdir -p build/amd64
  - export CGO_ENABLED=1
  - GOOS=linux GOARCH=amd64 go build --ldflags "-X main.version=${TRAVIS_TAG} -X main.build=${TRAVIS_BUILD_NUMBER} -X main.commit=${TRAVIS_COMMIT} -X main.docs=https://github.com/hinha/watchgo/blob/master/README.md" -o build/amd64/${MYAPP}-amd64 ./cmd/main.go

deploy:
  provider: releases
  email: martinuz.dawan9@gmail.com
  api_key:
    secure: ${GITHUB_TOKEN}
  file:
    - build/amd64/${MYAPP}-amd64
  skip_cleanup: true
  on:
    tags: true
    all_branches: true
